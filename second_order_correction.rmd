---
title: "Second order bias correction"
author: Bicko, Jonathan & Ben
date: "2021 Aug 11 (Mon)"
compact-title: false
output:
  pdf_document:
    extra_dependencies: ["float"]
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(fig.pos = "H", out.extra = "")

library(glmmTMB)
library(dplyr)
library(ggplot2)
library(vareffects); varefftheme()
library(ggpubr)
set.seed(1011)

```

\section{Introduction}

We consider Taylor series approximation approach for bias correction. Suppose $f(.)$ represents a back-transformation function, $\mu$ the mean and $\sigma^2_\mu$ on the linear predictor scale (**univariate case** // **what happens in multivariate case?**) predictor. Then using Taylor expansion around $\mu$, the approximation on the original scale is given by

\[
f(\mu) + \frac{1}{2}\sigma^2_{\mu}f''(\mu)
\]

To start with, we consider logistic function 

\[
g(\mu) = \frac{1}{1 + \exp(-\mu)},
\]
with the first and second derivatives give by

\[
g'(\mu) = g(\mu)(1 - g(\mu))
\]
and 

\[
g''(\mu) = g(\mu)g(-\mu)(1 - 2g(\mu))
\]
respectively.

```{r taylor_fun}
taylorapprox <- function(fun, mu, sigma, ...) {
	untrans <- fun(mu)
	der2 <- fun(mu)*fun(-mu)*(1 - 2*fun(mu))
	corrected <- untrans + der2*sigma^2/2
	return(corrected)
}
```

Let us consider a simple univariate case

```{r simple_univariate}
b0 <- 6
b1 <- 5
N <- 100
x <- scale(rnorm(N))
eta <- b0 + b1*x

corrected <- taylorapprox(plogis, mean(eta), sd(eta))
out <- c(NULL
	, mean = mean(plogis(eta))
	, uncorrected = plogis(mean(eta))
	, corrected = corrected
)
print(out)
logitnorm::momentsLogitnorm(mu= mean(eta), sigma = sd(eta))
emdbook::deltamethod(1/(1+exp(-x)), eta)
```

**??**

- How can we verify this?
- Does anything change in multivariate case?
- How does it work in _focal_--_non-focal_ variables case?
